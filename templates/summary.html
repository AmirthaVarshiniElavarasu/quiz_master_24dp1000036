{% extends 'index.html' %}
{% block title %} Summary{% endblock %}

{% block navbar %}
{% include "admin-navbar.html" %}
{% endblock %}

{% block content %}
<center>
    <div>

    </div>

    <div id="admin_users">
        <table>
            <tr>
                <td> User Id </td>
                <td> User Name </td>
                <td> Average Score </td>
            </tr>
            {% for user in users %}
            <tr>
                <td> {{ user.id }}</td>
                <td> {{ user.username }}</td>
        
                {% set user_scores = total_score | selectattr("user_score_id", "equalto", user.id) | map(attribute="score_total") | list %}
                {% set total = user_scores | sum %}
                {% set count = user_scores | length %}
                
                {% if count > 0 %}
                    {% set average_score = total / count %}
                    <td>{{ average_score | round(2) }}</td>
                {% else %}
                    <td> No Score </td>
                {% endif %}
            </tr>
            {% endfor %}
        </table>

       
    </div>
    <div id="chartData" data-bar-x-subjects='{{ bar_X_subjects | tojson | safe }}'
        data-bar-y-scores='{{ bar_y_scores | tojson | safe }}' data-bar-colors='{{ bar_Colors | tojson | safe }}'
        data-pie-x-subjects='{{ pie_X_subjects | tojson | safe }}'
        data-pie-y-scores='{{ pie_y_scores | tojson | safe }}' data-pie-colors='{{ pie_Colors | tojson | safe }}'>
    </div>
    
    <div style="display: flex; justify-content: space-around; align-items: center; width: 100%; height: 70vh;">
        <div style="flex: 1; max-width: 600px; height: 100%;">
            <canvas id="barChart"></canvas>
        </div>
        <div style="flex: 1; max-width: 600px; height: 100%;">
            <canvas id="pieChart"></canvas>
        </div>
    </div>




</center>
{% endblock %}